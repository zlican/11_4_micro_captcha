<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸»é¡µ</title>
    <link rel="stylesheet" href="./static/homeStyle.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-brand">ä¸ªäººä¸»é¡µ</div>
        <div class="nav-user">
            <span id="username">ç”¨æˆ·å</span>
            <div class="user-avatar"></div>
            <!-- æ·»åŠ ä¸‹æ‹‰èœå• -->
            <div class="dropdown-menu">

                <a href="/user" class="dropdown-item">
                    <i>ğŸ‘¤</i>
                    ä¸ªäººä¸­å¿ƒ
                </a>
                <a href="#" class="dropdown-item">
                    <i>âš™ï¸</i>
                    è´¦å·è®¾ç½®
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item" id="logout-btn">
                    <i>ğŸšª</i>
                    é€€å‡ºç™»å½•
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- å·¦ä¾§ä¸»è¦å†…å®¹ -->
        <main>
            <!-- æœç´¢æ¡† -->
            <div class="search-box">
                <input type="text" class="search-input" placeholder="æœç´¢æ–‡ç« ã€ç•™è¨€...">
            </div>

            <!-- æ–‡ç« åˆ—è¡¨ -->
            <div class="article-list">
                <h2>æœ€æ–°æ–‡ç« </h2>
                <div class="article-item">
                    <h3 class="article-title">ç¤ºä¾‹æ–‡ç« æ ‡é¢˜</h3>
                    <p class="article-preview">è¿™æ˜¯æ–‡ç« é¢„è§ˆå†…å®¹ï¼Œå±•ç¤ºéƒ¨åˆ†æ–‡ç« å†…å®¹...</p>
                </div>
                <!-- æ›´å¤šæ–‡ç« é¡¹... -->
            </div>

            <!-- ç•™è¨€æ¿ -->
            <div class="message-board">
                <h2>ç•™è¨€æ¿</h2>
                <textarea class="message-input" placeholder="å†™ä¸‹ä½ çš„ç•™è¨€..."></textarea>
                <button class="btn">å‘å¸ƒç•™è¨€</button>
                <div class="message-item">
                    <p>è¿™æ˜¯ä¸€æ¡ç¤ºä¾‹ç•™è¨€å†…å®¹</p>
                    <small>ç”¨æˆ·å - 2024-11-08</small>
                </div>
            </div>

            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-box">
                <div class="chat-messages">
                    <!-- èŠå¤©æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" placeholder="å‘é€æ¶ˆæ¯...">
                    <button class="btn">å‘é€</button>
                </div>
            </div>
        </main>

        <!-- å³ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">ä¸ªäººä¿¡æ¯</h3>
                <!-- ä¸ªäººä¿¡æ¯å†…å®¹ -->
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-title">çƒ­é—¨æ–‡ç« </h3>
                <!-- çƒ­é—¨æ–‡ç« åˆ—è¡¨ -->
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-title">åœ¨çº¿ç”¨æˆ·</h3>
                <!-- åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ -->
            </div>
        </aside>
    </div>

    <script>
        // ç¤ºä¾‹ï¼šè·å–ç”¨æˆ·å
        document.addEventListener('DOMContentLoaded', async function() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ ä»åç«¯è·å–ç”¨æˆ·ä¿¡æ¯çš„ä»£ç 
            var userName
            await fetch("http://127.0.0.1:8080/getUserInfo")
            .then(res => {
                return res.json()
            })
            .then(data => {
                userName = data.UserName
            })
            const username = localStorage.getItem('username') || userName;
            document.getElementById('username').textContent = username;
        });

        // å¤„ç†é€€å‡ºç™»å½•
        document.getElementById('logout-btn').addEventListener('click', async function(e) {
            e.preventDefault();
            // è¿™é‡Œæ·»åŠ é€€å‡ºç™»å½•çš„é€»è¾‘
            if(confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯
                //name = "mysession"
                //document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/;';
                await fetch("http://127.0.0.1:8080/deleteSession")
                .then(res => {
                    return res.json();
                })
                .then(data => {
                    alert(data.message);
                })
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = '/login';
            }
        });


        // ç¤ºä¾‹ï¼šå‘é€æ¶ˆæ¯åŠŸèƒ½
        document.querySelector('.chat-input-area .btn').addEventListener('click', function() {
            const input = document.querySelector('.chat-input');
            const message = input.value.trim();
            if (message) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€æ¶ˆæ¯åˆ°åç«¯çš„ä»£ç 
                const chatMessages = document.querySelector('.chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.textContent = message;
                chatMessages.appendChild(messageDiv);
                input.value = '';
            }
        });

        // ç¤ºä¾‹ï¼šå‘å¸ƒç•™è¨€åŠŸèƒ½
        document.querySelector('.message-board .btn').addEventListener('click', function() {
            const input = document.querySelector('.message-input');
            const message = input.value.trim();
            if (message) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€ç•™è¨€åˆ°åç«¯çš„ä»£ç 
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                messageItem.innerHTML = `
                    <p>${message}</p>
                    <small>${document.getElementById('username').textContent} - ${new Date().toLocaleDateString()}</small>
                `;
                input.value = '';
                document.querySelector('.message-board').appendChild(messageItem);
            }
        });
        
    </script>
</body>
</html>